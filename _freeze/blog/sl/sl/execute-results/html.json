{
  "hash": "8f4643011cff5d7d320380fb6342dac3",
  "result": {
    "markdown": "---\ntitle: \"Using {sl3} for superlearning\"\nauthor: \"Katherine Hoffman\"\ndate: 2019-09-12T21:13:14-05:00\ncategories: [\"R\"]\nimage: /img/sl3/sl_talk_screenshot.png\ndraft: false\nmath: true\nweight: 100\ntags: [\"R\"]\noutput: \n  html_document:\n    toc: true\n    toc_float: true\n    smart: false\n    print_df: paged\n---\n\n\nA short and sweet guide to using the R package {sl3} for superlearning. This is part of a tutorial created for an R Ladies NYC Talk in 2019.\n\n<!--more-->\n\n\n\n\n\n![](/img/sl3/slide_deck.png)\n**January 10, 2020.**\n\nIn September 2019, I gave an R-Ladies NYC presentation about using the package `sl3` to implement the superlearner algorithm for predictions. You can download the slides for it [here](https://github.com/kathoffman/sl3-demo/raw/master/superlearning_slides_no_animation.pdf). This post is a modification to the original demo I gave.\n\nFor a more in-depth background on what the superlearner algorithm is, please see my more [recent blog post](khstats.com/blog/sl/sl).\n\n# Step 0: Load your libraries, set a seed, and load the data\n\nYou'll likely need to install `sl3` from the `tlverse` github page, as it was not yet on CRAN at the time of writing this post.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#devtools::install_github(\"tlverse/sl3\")\nlibrary(sl3)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(gt)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(7)\n```\n:::\n\n\nWe will use the same WASH Benefits data set as the TLverse does in their [Hitchhiker's Guide](https://tlverse.org/tlverse-handbook/). We will be predicting children in rural Kenya and Bengladesh's weight to height z-scores.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwashb_data <- read.csv(\"https://raw.githubusercontent.com/tlverse/tlverse-data/master/wash-benefits/washb_data.csv\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngt(head(washb_data))\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"jsgbozvhxc\" style=\"overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#jsgbozvhxc .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#jsgbozvhxc .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#jsgbozvhxc .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#jsgbozvhxc .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#jsgbozvhxc .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#jsgbozvhxc .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#jsgbozvhxc .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#jsgbozvhxc .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#jsgbozvhxc .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#jsgbozvhxc .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#jsgbozvhxc .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#jsgbozvhxc .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#jsgbozvhxc .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#jsgbozvhxc .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#jsgbozvhxc .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#jsgbozvhxc .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#jsgbozvhxc .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#jsgbozvhxc .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#jsgbozvhxc .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#jsgbozvhxc .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#jsgbozvhxc .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#jsgbozvhxc .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#jsgbozvhxc .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#jsgbozvhxc .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#jsgbozvhxc .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#jsgbozvhxc .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#jsgbozvhxc .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#jsgbozvhxc .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#jsgbozvhxc .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#jsgbozvhxc .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#jsgbozvhxc .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#jsgbozvhxc .gt_left {\n  text-align: left;\n}\n\n#jsgbozvhxc .gt_center {\n  text-align: center;\n}\n\n#jsgbozvhxc .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#jsgbozvhxc .gt_font_normal {\n  font-weight: normal;\n}\n\n#jsgbozvhxc .gt_font_bold {\n  font-weight: bold;\n}\n\n#jsgbozvhxc .gt_font_italic {\n  font-style: italic;\n}\n\n#jsgbozvhxc .gt_super {\n  font-size: 65%;\n}\n\n#jsgbozvhxc .gt_two_val_uncert {\n  display: inline-block;\n  line-height: 1em;\n  text-align: right;\n  font-size: 60%;\n  vertical-align: -0.25em;\n  margin-left: 0.1em;\n}\n\n#jsgbozvhxc .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#jsgbozvhxc .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#jsgbozvhxc .gt_slash_mark {\n  font-size: 0.7em;\n  line-height: 0.7em;\n  vertical-align: 0.15em;\n}\n\n#jsgbozvhxc .gt_fraction_numerator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: 0.45em;\n}\n\n#jsgbozvhxc .gt_fraction_denominator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: -0.05em;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">whz</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">tr</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">fracode</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">month</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">aged</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">sex</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">momage</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">momedu</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">momheight</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">hfiacat</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Nlt18</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Ncomp</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">watmin</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">elec</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">floor</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">walls</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">roof</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">asset_wardrobe</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">asset_table</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">asset_chair</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">asset_khat</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">asset_chouki</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">asset_tv</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">asset_refrig</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">asset_bike</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">asset_moto</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">asset_sewmach</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">asset_mobile</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td class=\"gt_row gt_right\">0.00</td>\n<td class=\"gt_row gt_left\">Control</td>\n<td class=\"gt_row gt_left\">N05265</td>\n<td class=\"gt_row gt_right\">9</td>\n<td class=\"gt_row gt_right\">268</td>\n<td class=\"gt_row gt_left\">male</td>\n<td class=\"gt_row gt_right\">30</td>\n<td class=\"gt_row gt_left\">Primary (1-5y)</td>\n<td class=\"gt_row gt_right\">146.40</td>\n<td class=\"gt_row gt_left\">Food Secure</td>\n<td class=\"gt_row gt_right\">3</td>\n<td class=\"gt_row gt_right\">11</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td></tr>\n    <tr><td class=\"gt_row gt_right\">-1.16</td>\n<td class=\"gt_row gt_left\">Control</td>\n<td class=\"gt_row gt_left\">N05265</td>\n<td class=\"gt_row gt_right\">9</td>\n<td class=\"gt_row gt_right\">286</td>\n<td class=\"gt_row gt_left\">male</td>\n<td class=\"gt_row gt_right\">25</td>\n<td class=\"gt_row gt_left\">Primary (1-5y)</td>\n<td class=\"gt_row gt_right\">148.75</td>\n<td class=\"gt_row gt_left\">Moderately Food Insecure</td>\n<td class=\"gt_row gt_right\">2</td>\n<td class=\"gt_row gt_right\">4</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td></tr>\n    <tr><td class=\"gt_row gt_right\">-1.05</td>\n<td class=\"gt_row gt_left\">Control</td>\n<td class=\"gt_row gt_left\">N08002</td>\n<td class=\"gt_row gt_right\">9</td>\n<td class=\"gt_row gt_right\">264</td>\n<td class=\"gt_row gt_left\">male</td>\n<td class=\"gt_row gt_right\">25</td>\n<td class=\"gt_row gt_left\">Primary (1-5y)</td>\n<td class=\"gt_row gt_right\">152.15</td>\n<td class=\"gt_row gt_left\">Food Secure</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">10</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td></tr>\n    <tr><td class=\"gt_row gt_right\">-1.26</td>\n<td class=\"gt_row gt_left\">Control</td>\n<td class=\"gt_row gt_left\">N08002</td>\n<td class=\"gt_row gt_right\">9</td>\n<td class=\"gt_row gt_right\">252</td>\n<td class=\"gt_row gt_left\">female</td>\n<td class=\"gt_row gt_right\">28</td>\n<td class=\"gt_row gt_left\">Primary (1-5y)</td>\n<td class=\"gt_row gt_right\">140.25</td>\n<td class=\"gt_row gt_left\">Food Secure</td>\n<td class=\"gt_row gt_right\">3</td>\n<td class=\"gt_row gt_right\">5</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td></tr>\n    <tr><td class=\"gt_row gt_right\">-0.59</td>\n<td class=\"gt_row gt_left\">Control</td>\n<td class=\"gt_row gt_left\">N06531</td>\n<td class=\"gt_row gt_right\">9</td>\n<td class=\"gt_row gt_right\">336</td>\n<td class=\"gt_row gt_left\">female</td>\n<td class=\"gt_row gt_right\">19</td>\n<td class=\"gt_row gt_left\">Secondary (&gt;5y)</td>\n<td class=\"gt_row gt_right\">150.95</td>\n<td class=\"gt_row gt_left\">Food Secure</td>\n<td class=\"gt_row gt_right\">2</td>\n<td class=\"gt_row gt_right\">7</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td></tr>\n    <tr><td class=\"gt_row gt_right\">-0.51</td>\n<td class=\"gt_row gt_left\">Control</td>\n<td class=\"gt_row gt_left\">N06531</td>\n<td class=\"gt_row gt_right\">9</td>\n<td class=\"gt_row gt_right\">304</td>\n<td class=\"gt_row gt_left\">male</td>\n<td class=\"gt_row gt_right\">20</td>\n<td class=\"gt_row gt_left\">Secondary (&gt;5y)</td>\n<td class=\"gt_row gt_right\">154.20</td>\n<td class=\"gt_row gt_left\">Severely Food Insecure</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">3</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\n# Step 1: Specify outcome and predictors\n\nWe need the columns for the outcome and predictors to be specified as strings.\n\n\n::: {.cell}\n\n```{.r .cell-code}\noutcome <- \"whz\"\ncovars <- washb_data %>%\n  select(-whz) %>%\n  names()\n```\n:::\n\n\n# Step 2: Make an sl3 task\n\nThis is the object we'll use whenever we want to fit a statistical model in `sl3`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwashb_task <- make_sl3_Task(\n  data = washb_data,\n  covariates = covars,\n  outcome = outcome\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in process_data(data, nodes, column_names = column_names, flag = flag, : Character covariates found: tr, fracode, sex, momedu, hfiacat;\nConverting these to factors\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in process_data(data, nodes, column_names = column_names, flag = flag, :\nMissing covariate data detected: imputing covariates.\n```\n:::\n:::\n\n\nNote that we can't have missing data in most statistical learning algorithms, so `sl3`'s default pre-processing imputes at the median and adds a column for missingness (in case the missingness is informative).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwashb_task\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAn sl3 Task with 4695 obs and these nodes:\n$covariates\n [1] \"tr\"              \"fracode\"         \"month\"           \"aged\"           \n [5] \"sex\"             \"momage\"          \"momedu\"          \"momheight\"      \n [9] \"hfiacat\"         \"Nlt18\"           \"Ncomp\"           \"watmin\"         \n[13] \"elec\"            \"floor\"           \"walls\"           \"roof\"           \n[17] \"asset_wardrobe\"  \"asset_table\"     \"asset_chair\"     \"asset_khat\"     \n[21] \"asset_chouki\"    \"asset_tv\"        \"asset_refrig\"    \"asset_bike\"     \n[25] \"asset_moto\"      \"asset_sewmach\"   \"asset_mobile\"    \"delta_momage\"   \n[29] \"delta_momheight\"\n\n$outcome\n[1] \"whz\"\n\n$id\nNULL\n\n$weights\nNULL\n\n$offset\nNULL\n\n$time\nNULL\n```\n:::\n:::\n\n\n## An aside: Exploring `sl3`'s many options\n\nThere's a ton of different aspects of model fitting `sl3` has the capabilities to address. For example, we can look into algorithms for when the outcome is binomial, categorical, or continuous. There are also options for when you have clustered data, or if you need to preprocess/screen your data before implementing base learners.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsl3_list_properties()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"binomial\"      \"categorical\"   \"continuous\"    \"cv\"           \n [5] \"density\"       \"h2o\"           \"ids\"           \"importance\"   \n [9] \"offset\"        \"preprocessing\" \"sampling\"      \"screener\"     \n[13] \"timeseries\"    \"weights\"       \"wrapper\"      \n```\n:::\n:::\n\nWe can learn more about each of these properties on this [reference page](https://tlverse.org/sl3/reference/index.html).\n\n## Another aside: looking at available \"learners\"\n\nWe'll need to pick out base learners for our stack, as well as pick a metalearner. Since we are trying to predict z-scores, a continuous variable, let's look at our potential learners for a continuous variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsl3_list_learners(\"continuous\") \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"Lrnr_arima\"                     \"Lrnr_bartMachine\"              \n [3] \"Lrnr_bayesglm\"                  \"Lrnr_bilstm\"                   \n [5] \"Lrnr_bound\"                     \"Lrnr_caret\"                    \n [7] \"Lrnr_cv_selector\"               \"Lrnr_dbarts\"                   \n [9] \"Lrnr_earth\"                     \"Lrnr_expSmooth\"                \n[11] \"Lrnr_ga\"                        \"Lrnr_gam\"                      \n[13] \"Lrnr_gbm\"                       \"Lrnr_glm\"                      \n[15] \"Lrnr_glm_fast\"                  \"Lrnr_glmnet\"                   \n[17] \"Lrnr_grf\"                       \"Lrnr_gru_keras\"                \n[19] \"Lrnr_gts\"                       \"Lrnr_h2o_glm\"                  \n[21] \"Lrnr_h2o_grid\"                  \"Lrnr_hal9001\"                  \n[23] \"Lrnr_HarmonicReg\"               \"Lrnr_hts\"                      \n[25] \"Lrnr_lightgbm\"                  \"Lrnr_lstm_keras\"               \n[27] \"Lrnr_mean\"                      \"Lrnr_multiple_ts\"              \n[29] \"Lrnr_nnet\"                      \"Lrnr_nnls\"                     \n[31] \"Lrnr_optim\"                     \"Lrnr_pkg_SuperLearner\"         \n[33] \"Lrnr_pkg_SuperLearner_method\"   \"Lrnr_pkg_SuperLearner_screener\"\n[35] \"Lrnr_polspline\"                 \"Lrnr_randomForest\"             \n[37] \"Lrnr_ranger\"                    \"Lrnr_rpart\"                    \n[39] \"Lrnr_rugarch\"                   \"Lrnr_screener_correlation\"     \n[41] \"Lrnr_solnp\"                     \"Lrnr_stratified\"               \n[43] \"Lrnr_svm\"                       \"Lrnr_tsDyn\"                    \n[45] \"Lrnr_xgboost\"                  \n```\n:::\n:::\n\n\nYou'll notice each learner starts with `Lrnr` and seems to correspond to a package in `R`.\n\n# Step 3: Choosing the base learners\n\nLet's pick just a few base learners to match the examples in my slides: a random forest, a generalized boosting model, and a generalized linear model. Let's keep their default parameters for now.\n\n`make_learner_stack()` is an easy way to create a stack of default baselearners. It takes the names of the learners as strings and you're good to go!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstack <- make_learner_stack(\n  \"Lrnr_randomForest\", \n  \"Lrnr_gbm\",\n  \"Lrnr_glm\"\n)\n```\n:::\n\n\n# Step 4: Choose a metalearner\n\nThere are many models we can choose from but we'll keep it simple and use a generalized linear model. We are again using the `make_learner()` function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmetalearner <- make_learner(Lrnr_glm)\n```\n:::\n\n\n# Step 5: Make a superlearner object\n\nRemember, under-the-hood `Lrnr_sl` takes the cross-validated predictions from the base models and uses them to predict the true outcome. That prediction model then is used to fit the predictions from base learners fit on the whole data set.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsl <- make_learner(Lrnr_sl, \n                   learners = stack,\n                   metalearner = metalearner)\n```\n:::\n\n\nA superlearner object has different functions built into it, such as `train()`. We can train our superlearner shell model on the task we made earlier.\n\n# Step 6: Train your superlearner\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsl_fit <- sl$train(washb_task)\n```\n:::\n\n\n# Step 7: Examine the results of the superlearner\n\n## Examine coefficients and CV-risk\n\nThe default risk is MSE (Mean Squared Error). The coefficients show you how the metalearner decided to weight each base model for the final ensemble.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsl_fit$print() %>% gt()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"SuperLearner:\"\nList of 3\n $ : chr \"Lrnr_randomForest_500_TRUE_5\"\n $ : chr \"Lrnr_gbm_10000_2_0.001\"\n $ : chr \"Lrnr_glm_TRUE\"\n[1] \"Lrnr_glm_TRUE\"\n$coefficients\n                   intercept Lrnr_randomForest_500_TRUE_5 \n                -0.037630882                  0.056299184 \n      Lrnr_gbm_10000_2_0.001                Lrnr_glm_TRUE \n                 0.876353346                  0.005369642 \n\n$R\n                             intercept Lrnr_randomForest_500_TRUE_5\nintercept                    -68.52007                     39.84692\nLrnr_randomForest_500_TRUE_5   0.00000                     21.59036\nLrnr_gbm_10000_2_0.001         0.00000                      0.00000\nLrnr_glm_TRUE                  0.00000                      0.00000\n                             Lrnr_gbm_10000_2_0.001 Lrnr_glm_TRUE\nintercept                                  40.07621     40.091631\nLrnr_randomForest_500_TRUE_5               14.60067     13.860606\nLrnr_gbm_10000_2_0.001                     10.05776      9.862373\nLrnr_glm_TRUE                               0.00000     -8.642721\n\n$rank\n[1] 4\n\n$family\n\nFamily: gaussian \nLink function: identity \n\n\n$deviance\n[1] 4723.324\n\n$aic\n[1] 13362.07\n\n$null.deviance\n[1] 5000.347\n\n$iter\n[1] 2\n\n$df.residual\n[1] 4691\n\n$df.null\n[1] 4694\n\n$converged\n[1] TRUE\n\n$boundary\n[1] FALSE\n\n$linkinv_fun\nfunction (eta) \neta\n<environment: namespace:stats>\n\n$link_fun\nfunction (mu) \nmu\n<environment: namespace:stats>\n\n$training_offset\n[1] FALSE\n\n[1] \"Cross-validated risk:\"\n                        learner coefficients      MSE        se    fold_sd\n1: Lrnr_randomForest_500_TRUE_5  0.056299184 1.034798 0.0237462 0.07053924\n2:       Lrnr_gbm_10000_2_0.001  0.876353346 1.006393 0.0233679 0.07188694\n3:                Lrnr_glm_TRUE  0.005369642 1.021995 0.0238539 0.06474016\n4:                 SuperLearner           NA 1.006033 0.0233913 0.07107934\n   fold_min_MSE fold_max_MSE\n1:    0.9099614     1.165088\n2:    0.8753148     1.121065\n3:    0.8900577     1.116998\n4:    0.8772851     1.119882\n```\n:::\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"cptwmtqzfn\" style=\"overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#cptwmtqzfn .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#cptwmtqzfn .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#cptwmtqzfn .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#cptwmtqzfn .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#cptwmtqzfn .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#cptwmtqzfn .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#cptwmtqzfn .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#cptwmtqzfn .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#cptwmtqzfn .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#cptwmtqzfn .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#cptwmtqzfn .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#cptwmtqzfn .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#cptwmtqzfn .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#cptwmtqzfn .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#cptwmtqzfn .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#cptwmtqzfn .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#cptwmtqzfn .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cptwmtqzfn .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#cptwmtqzfn .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#cptwmtqzfn .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cptwmtqzfn .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#cptwmtqzfn .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#cptwmtqzfn .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#cptwmtqzfn .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cptwmtqzfn .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#cptwmtqzfn .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#cptwmtqzfn .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#cptwmtqzfn .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#cptwmtqzfn .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cptwmtqzfn .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#cptwmtqzfn .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cptwmtqzfn .gt_left {\n  text-align: left;\n}\n\n#cptwmtqzfn .gt_center {\n  text-align: center;\n}\n\n#cptwmtqzfn .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#cptwmtqzfn .gt_font_normal {\n  font-weight: normal;\n}\n\n#cptwmtqzfn .gt_font_bold {\n  font-weight: bold;\n}\n\n#cptwmtqzfn .gt_font_italic {\n  font-style: italic;\n}\n\n#cptwmtqzfn .gt_super {\n  font-size: 65%;\n}\n\n#cptwmtqzfn .gt_two_val_uncert {\n  display: inline-block;\n  line-height: 1em;\n  text-align: right;\n  font-size: 60%;\n  vertical-align: -0.25em;\n  margin-left: 0.1em;\n}\n\n#cptwmtqzfn .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#cptwmtqzfn .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#cptwmtqzfn .gt_slash_mark {\n  font-size: 0.7em;\n  line-height: 0.7em;\n  vertical-align: 0.15em;\n}\n\n#cptwmtqzfn .gt_fraction_numerator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: 0.45em;\n}\n\n#cptwmtqzfn .gt_fraction_denominator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: -0.05em;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\">learner</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">coefficients</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">MSE</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">se</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">fold_sd</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">fold_min_MSE</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">fold_max_MSE</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td class=\"gt_row gt_center\">Lrnr_randomForest_500_TRUE_5</td>\n<td class=\"gt_row gt_right\">0.056299184</td>\n<td class=\"gt_row gt_right\">1.034798</td>\n<td class=\"gt_row gt_right\">0.0237462</td>\n<td class=\"gt_row gt_right\">0.07053924</td>\n<td class=\"gt_row gt_right\">0.9099614</td>\n<td class=\"gt_row gt_right\">1.165088</td></tr>\n    <tr><td class=\"gt_row gt_center\">Lrnr_gbm_10000_2_0.001</td>\n<td class=\"gt_row gt_right\">0.876353346</td>\n<td class=\"gt_row gt_right\">1.006393</td>\n<td class=\"gt_row gt_right\">0.0233679</td>\n<td class=\"gt_row gt_right\">0.07188694</td>\n<td class=\"gt_row gt_right\">0.8753148</td>\n<td class=\"gt_row gt_right\">1.121065</td></tr>\n    <tr><td class=\"gt_row gt_center\">Lrnr_glm_TRUE</td>\n<td class=\"gt_row gt_right\">0.005369642</td>\n<td class=\"gt_row gt_right\">1.021995</td>\n<td class=\"gt_row gt_right\">0.0238539</td>\n<td class=\"gt_row gt_right\">0.06474016</td>\n<td class=\"gt_row gt_right\">0.8900577</td>\n<td class=\"gt_row gt_right\">1.116998</td></tr>\n    <tr><td class=\"gt_row gt_center\">SuperLearner</td>\n<td class=\"gt_row gt_right\">NA</td>\n<td class=\"gt_row gt_right\">1.006033</td>\n<td class=\"gt_row gt_right\">0.0233913</td>\n<td class=\"gt_row gt_right\">0.07107934</td>\n<td class=\"gt_row gt_right\">0.8772851</td>\n<td class=\"gt_row gt_right\">1.119882</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\n## Look at the predictions\n\n`predict()` allows you to see what the model predicts on any given task. Here we look at predictions from the same data we trained the superlearner on, so the predicted weight to height z-scores of the first six children in our data set.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsl_fit$predict(washb_task) %>% head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -0.6641946 -0.7508882 -0.7014290 -0.7542267 -0.6456398 -0.6791542\n```\n:::\n:::\n\n\n# Extras\n\n- Cross validate your entire ensembled superlearner using the cross-validation package `origami`, written by the same authors as `sl3`. Or just hold out a testing data set to evaluate performance.\n\n- Use `make_learner()` to customize the tuning parameters of your base learners or metalearner. Ex: `lrnr_RF_200trees <- make_lrnr(Lrnr_randomForest, ntree = 200)`\n\n- Add many layers to your superlearner and organize it into a \"pipeline\"\n\n**For more demos, check out the following teaching materials from the authors of `sl3`.** My tutorial uses one of their example data sets in case you'd like to extend your learning via their training resources.\n\n- https://tlverse.org/tlverse-handbook/ensemble-machine-learning.html\n\n- https://tlverse.org/acic2019-workshop/ensemble-machine-learning.html\n\n- https://github.com/tlverse/sl3_lecture",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}