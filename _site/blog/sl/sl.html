<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Katherine Hoffman">
<meta name="dcterms.date" content="2019-09-12">

<title>KHstats - Using {sl3} for superlearning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../..//img/climbing_comic.jpg" rel="icon" type="image/jpeg">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-136820093-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <meta property="og:title" content="KH Stats">
<meta property="og:description" content="{(bio)statistics, causal inference, data visualization, R programming, medical research}">
<meta property="og:image" content="www.khstats.com/img/climbing_comic.jpg">
<meta property="og:site-name" content="KHstats">
<meta name="twitter:title" content="KH Stats">
<meta name="twitter:description" content="{(bio)statistics, causal inference, data visualization, R programming, medical research}">
<meta name="twitter:image" content="www.khstats.com/img/climbing_comic.jpg">
<meta name="twitter:creator" content="@kat_hoffman_">
<meta name="twitter:card" content="summary">
</head><body class="docked nav-fixed">true





<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">KHstats</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../talks.html" rel="" target="">
 <span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-illustrations" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Illustrations</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-illustrations">    
        <li>
    <a class="dropdown-item" href="../../art/illustrations_viz.html" rel="" target="">
 <span class="dropdown-text">Visual Guides for Causal Inference</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../art/illustrations_draw.html" rel="" target="">
 <span class="dropdown-text">Educational Drawings and Comics</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-research" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Research</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-research">    
        <li>
    <a class="dropdown-item" href="../../pubs/pubs_methods.html" rel="" target="">
 <span class="dropdown-text">Statistics Methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../pubs/pubs_applications.html" rel="" target="">
 <span class="dropdown-text">Clinical Applications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://scholar.google.com/citations?user=73RvTUoAAAAJ&amp;hl=en" rel="" target="">
 <span class="dropdown-text">Google Scholar Profile</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/kat_hoffman_" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/kathoffman" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../static/KatherineHoffman_CV_Sept2023.pdf" rel="" target="">
 <span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:kathoffman.stats@gmail.com" rel="" target=""><i class="bi bi-envelope" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Using {sl3} for superlearning</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">R</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Katherine Hoffman </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 12, 2019</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#step-0-load-your-libraries-set-a-seed-and-load-the-data" id="toc-step-0-load-your-libraries-set-a-seed-and-load-the-data" class="nav-link active" data-scroll-target="#step-0-load-your-libraries-set-a-seed-and-load-the-data">Step 0: Load your libraries, set a seed, and load the data</a></li>
  <li><a href="#step-1-specify-outcome-and-predictors" id="toc-step-1-specify-outcome-and-predictors" class="nav-link" data-scroll-target="#step-1-specify-outcome-and-predictors">Step 1: Specify outcome and predictors</a></li>
  <li><a href="#step-2-make-an-sl3-task" id="toc-step-2-make-an-sl3-task" class="nav-link" data-scroll-target="#step-2-make-an-sl3-task">Step 2: Make an sl3 task</a>
  <ul class="collapse">
  <li><a href="#an-aside-exploring-sl3s-many-options" id="toc-an-aside-exploring-sl3s-many-options" class="nav-link" data-scroll-target="#an-aside-exploring-sl3s-many-options">An aside: Exploring <code>sl3</code>’s many options</a></li>
  <li><a href="#another-aside-looking-at-available-learners" id="toc-another-aside-looking-at-available-learners" class="nav-link" data-scroll-target="#another-aside-looking-at-available-learners">Another aside: looking at available “learners”</a></li>
  </ul></li>
  <li><a href="#step-3-choosing-the-base-learners" id="toc-step-3-choosing-the-base-learners" class="nav-link" data-scroll-target="#step-3-choosing-the-base-learners">Step 3: Choosing the base learners</a></li>
  <li><a href="#step-4-choose-a-metalearner" id="toc-step-4-choose-a-metalearner" class="nav-link" data-scroll-target="#step-4-choose-a-metalearner">Step 4: Choose a metalearner</a></li>
  <li><a href="#step-5-make-a-superlearner-object" id="toc-step-5-make-a-superlearner-object" class="nav-link" data-scroll-target="#step-5-make-a-superlearner-object">Step 5: Make a superlearner object</a></li>
  <li><a href="#step-6-train-your-superlearner" id="toc-step-6-train-your-superlearner" class="nav-link" data-scroll-target="#step-6-train-your-superlearner">Step 6: Train your superlearner</a></li>
  <li><a href="#step-7-examine-the-results-of-the-superlearner" id="toc-step-7-examine-the-results-of-the-superlearner" class="nav-link" data-scroll-target="#step-7-examine-the-results-of-the-superlearner">Step 7: Examine the results of the superlearner</a>
  <ul class="collapse">
  <li><a href="#examine-coefficients-and-cv-risk" id="toc-examine-coefficients-and-cv-risk" class="nav-link" data-scroll-target="#examine-coefficients-and-cv-risk">Examine coefficients and CV-risk</a></li>
  <li><a href="#look-at-the-predictions" id="toc-look-at-the-predictions" class="nav-link" data-scroll-target="#look-at-the-predictions">Look at the predictions</a></li>
  </ul></li>
  <li><a href="#extras" id="toc-extras" class="nav-link" data-scroll-target="#extras">Extras</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>A short and sweet guide to using the R package {sl3} for superlearning. This is part of a tutorial created for an R Ladies NYC Talk in 2019.</p>
<!--more-->
<p><img src="../../img/sl3/slide_deck.png" class="img-fluid"> <strong>January 10, 2020.</strong></p>
<p>In September 2019, I gave an R-Ladies NYC presentation about using the package <code>sl3</code> to implement the superlearner algorithm for predictions. You can download the slides for it <a href="https://github.com/kathoffman/sl3-demo/raw/master/superlearning_slides_no_animation.pdf">here</a>. This post is a modification to the original demo I gave.</p>
<p>For a more in-depth background on what the superlearner algorithm is, please see my more <a href="khstats.com/blog/sl/sl">recent blog post</a>.</p>
<section id="step-0-load-your-libraries-set-a-seed-and-load-the-data" class="level1">
<h1>Step 0: Load your libraries, set a seed, and load the data</h1>
<p>You’ll likely need to install <code>sl3</code> from the <code>tlverse</code> github page, as it was not yet on CRAN at the time of writing this post.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#devtools::install_github("tlverse/sl3")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sl3)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will use the same WASH Benefits data set as the TLverse does in their <a href="https://tlverse.org/tlverse-handbook/">Hitchhiker’s Guide</a>. We will be predicting children in rural Kenya and Bengladesh’s weight to height z-scores.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>washb_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/tlverse/tlverse-data/master/wash-benefits/washb_data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(<span class="fu">head</span>(washb_data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="jsgbozvhxc" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#jsgbozvhxc .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jsgbozvhxc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jsgbozvhxc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jsgbozvhxc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jsgbozvhxc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jsgbozvhxc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jsgbozvhxc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jsgbozvhxc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jsgbozvhxc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jsgbozvhxc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jsgbozvhxc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jsgbozvhxc .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#jsgbozvhxc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jsgbozvhxc .gt_from_md > :first-child {
  margin-top: 0;
}

#jsgbozvhxc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jsgbozvhxc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jsgbozvhxc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#jsgbozvhxc .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#jsgbozvhxc .gt_row_group_first td {
  border-top-width: 2px;
}

#jsgbozvhxc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jsgbozvhxc .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#jsgbozvhxc .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#jsgbozvhxc .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jsgbozvhxc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jsgbozvhxc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jsgbozvhxc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jsgbozvhxc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jsgbozvhxc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jsgbozvhxc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jsgbozvhxc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jsgbozvhxc .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jsgbozvhxc .gt_left {
  text-align: left;
}

#jsgbozvhxc .gt_center {
  text-align: center;
}

#jsgbozvhxc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jsgbozvhxc .gt_font_normal {
  font-weight: normal;
}

#jsgbozvhxc .gt_font_bold {
  font-weight: bold;
}

#jsgbozvhxc .gt_font_italic {
  font-style: italic;
}

#jsgbozvhxc .gt_super {
  font-size: 65%;
}

#jsgbozvhxc .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#jsgbozvhxc .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#jsgbozvhxc .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#jsgbozvhxc .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#jsgbozvhxc .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#jsgbozvhxc .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true">
<thead class="gt_col_headings">
<tr class="header">
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">whz</th>
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th">tr</th>
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th">fracode</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">month</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">aged</th>
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th">sex</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">momage</th>
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th">momedu</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">momheight</th>
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th">hfiacat</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">Nlt18</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">Ncomp</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">watmin</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">elec</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">floor</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">walls</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">roof</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">asset_wardrobe</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">asset_table</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">asset_chair</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">asset_khat</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">asset_chouki</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">asset_tv</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">asset_refrig</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">asset_bike</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">asset_moto</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">asset_sewmach</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">asset_mobile</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right">0.00</td>
<td class="gt_row gt_left">Control</td>
<td class="gt_row gt_left">N05265</td>
<td class="gt_row gt_right">9</td>
<td class="gt_row gt_right">268</td>
<td class="gt_row gt_left">male</td>
<td class="gt_row gt_right">30</td>
<td class="gt_row gt_left">Primary (1-5y)</td>
<td class="gt_row gt_right">146.40</td>
<td class="gt_row gt_left">Food Secure</td>
<td class="gt_row gt_right">3</td>
<td class="gt_row gt_right">11</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
</tr>
<tr class="even">
<td class="gt_row gt_right">-1.16</td>
<td class="gt_row gt_left">Control</td>
<td class="gt_row gt_left">N05265</td>
<td class="gt_row gt_right">9</td>
<td class="gt_row gt_right">286</td>
<td class="gt_row gt_left">male</td>
<td class="gt_row gt_right">25</td>
<td class="gt_row gt_left">Primary (1-5y)</td>
<td class="gt_row gt_right">148.75</td>
<td class="gt_row gt_left">Moderately Food Insecure</td>
<td class="gt_row gt_right">2</td>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right">-1.05</td>
<td class="gt_row gt_left">Control</td>
<td class="gt_row gt_left">N08002</td>
<td class="gt_row gt_right">9</td>
<td class="gt_row gt_right">264</td>
<td class="gt_row gt_left">male</td>
<td class="gt_row gt_right">25</td>
<td class="gt_row gt_left">Primary (1-5y)</td>
<td class="gt_row gt_right">152.15</td>
<td class="gt_row gt_left">Food Secure</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">10</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
</tr>
<tr class="even">
<td class="gt_row gt_right">-1.26</td>
<td class="gt_row gt_left">Control</td>
<td class="gt_row gt_left">N08002</td>
<td class="gt_row gt_right">9</td>
<td class="gt_row gt_right">252</td>
<td class="gt_row gt_left">female</td>
<td class="gt_row gt_right">28</td>
<td class="gt_row gt_left">Primary (1-5y)</td>
<td class="gt_row gt_right">140.25</td>
<td class="gt_row gt_left">Food Secure</td>
<td class="gt_row gt_right">3</td>
<td class="gt_row gt_right">5</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right">-0.59</td>
<td class="gt_row gt_left">Control</td>
<td class="gt_row gt_left">N06531</td>
<td class="gt_row gt_right">9</td>
<td class="gt_row gt_right">336</td>
<td class="gt_row gt_left">female</td>
<td class="gt_row gt_right">19</td>
<td class="gt_row gt_left">Secondary (&gt;5y)</td>
<td class="gt_row gt_right">150.95</td>
<td class="gt_row gt_left">Food Secure</td>
<td class="gt_row gt_right">2</td>
<td class="gt_row gt_right">7</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
</tr>
<tr class="even">
<td class="gt_row gt_right">-0.51</td>
<td class="gt_row gt_left">Control</td>
<td class="gt_row gt_left">N06531</td>
<td class="gt_row gt_right">9</td>
<td class="gt_row gt_right">304</td>
<td class="gt_row gt_left">male</td>
<td class="gt_row gt_right">20</td>
<td class="gt_row gt_left">Secondary (&gt;5y)</td>
<td class="gt_row gt_right">154.20</td>
<td class="gt_row gt_left">Severely Food Insecure</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">3</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="step-1-specify-outcome-and-predictors" class="level1">
<h1>Step 1: Specify outcome and predictors</h1>
<p>We need the columns for the outcome and predictors to be specified as strings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>outcome <span class="ot">&lt;-</span> <span class="st">"whz"</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>covars <span class="ot">&lt;-</span> washb_data <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>whz) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-2-make-an-sl3-task" class="level1">
<h1>Step 2: Make an sl3 task</h1>
<p>This is the object we’ll use whenever we want to fit a statistical model in <code>sl3</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>washb_task <span class="ot">&lt;-</span> <span class="fu">make_sl3_Task</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> washb_data,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">covariates =</span> covars,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> outcome</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in process_data(data, nodes, column_names = column_names, flag = flag, : Character covariates found: tr, fracode, sex, momedu, hfiacat;
Converting these to factors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in process_data(data, nodes, column_names = column_names, flag = flag, :
Missing covariate data detected: imputing covariates.</code></pre>
</div>
</div>
<p>Note that we can’t have missing data in most statistical learning algorithms, so <code>sl3</code>’s default pre-processing imputes at the median and adds a column for missingness (in case the missingness is informative).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>washb_task</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An sl3 Task with 4695 obs and these nodes:
$covariates
 [1] "tr"              "fracode"         "month"           "aged"           
 [5] "sex"             "momage"          "momedu"          "momheight"      
 [9] "hfiacat"         "Nlt18"           "Ncomp"           "watmin"         
[13] "elec"            "floor"           "walls"           "roof"           
[17] "asset_wardrobe"  "asset_table"     "asset_chair"     "asset_khat"     
[21] "asset_chouki"    "asset_tv"        "asset_refrig"    "asset_bike"     
[25] "asset_moto"      "asset_sewmach"   "asset_mobile"    "delta_momage"   
[29] "delta_momheight"

$outcome
[1] "whz"

$id
NULL

$weights
NULL

$offset
NULL

$time
NULL</code></pre>
</div>
</div>
<section id="an-aside-exploring-sl3s-many-options" class="level2">
<h2 class="anchored" data-anchor-id="an-aside-exploring-sl3s-many-options">An aside: Exploring <code>sl3</code>’s many options</h2>
<p>There’s a ton of different aspects of model fitting <code>sl3</code> has the capabilities to address. For example, we can look into algorithms for when the outcome is binomial, categorical, or continuous. There are also options for when you have clustered data, or if you need to preprocess/screen your data before implementing base learners.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sl3_list_properties</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "binomial"      "categorical"   "continuous"    "cv"           
 [5] "density"       "h2o"           "ids"           "importance"   
 [9] "offset"        "preprocessing" "sampling"      "screener"     
[13] "timeseries"    "weights"       "wrapper"      </code></pre>
</div>
</div>
<p>We can learn more about each of these properties on this <a href="https://tlverse.org/sl3/reference/index.html">reference page</a>.</p>
</section>
<section id="another-aside-looking-at-available-learners" class="level2">
<h2 class="anchored" data-anchor-id="another-aside-looking-at-available-learners">Another aside: looking at available “learners”</h2>
<p>We’ll need to pick out base learners for our stack, as well as pick a metalearner. Since we are trying to predict z-scores, a continuous variable, let’s look at our potential learners for a continuous variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sl3_list_learners</span>(<span class="st">"continuous"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Lrnr_arima"                     "Lrnr_bartMachine"              
 [3] "Lrnr_bayesglm"                  "Lrnr_bilstm"                   
 [5] "Lrnr_bound"                     "Lrnr_caret"                    
 [7] "Lrnr_cv_selector"               "Lrnr_dbarts"                   
 [9] "Lrnr_earth"                     "Lrnr_expSmooth"                
[11] "Lrnr_ga"                        "Lrnr_gam"                      
[13] "Lrnr_gbm"                       "Lrnr_glm"                      
[15] "Lrnr_glm_fast"                  "Lrnr_glmnet"                   
[17] "Lrnr_grf"                       "Lrnr_gru_keras"                
[19] "Lrnr_gts"                       "Lrnr_h2o_glm"                  
[21] "Lrnr_h2o_grid"                  "Lrnr_hal9001"                  
[23] "Lrnr_HarmonicReg"               "Lrnr_hts"                      
[25] "Lrnr_lightgbm"                  "Lrnr_lstm_keras"               
[27] "Lrnr_mean"                      "Lrnr_multiple_ts"              
[29] "Lrnr_nnet"                      "Lrnr_nnls"                     
[31] "Lrnr_optim"                     "Lrnr_pkg_SuperLearner"         
[33] "Lrnr_pkg_SuperLearner_method"   "Lrnr_pkg_SuperLearner_screener"
[35] "Lrnr_polspline"                 "Lrnr_randomForest"             
[37] "Lrnr_ranger"                    "Lrnr_rpart"                    
[39] "Lrnr_rugarch"                   "Lrnr_screener_correlation"     
[41] "Lrnr_solnp"                     "Lrnr_stratified"               
[43] "Lrnr_svm"                       "Lrnr_tsDyn"                    
[45] "Lrnr_xgboost"                  </code></pre>
</div>
</div>
<p>You’ll notice each learner starts with <code>Lrnr</code> and seems to correspond to a package in <code>R</code>.</p>
</section>
</section>
<section id="step-3-choosing-the-base-learners" class="level1">
<h1>Step 3: Choosing the base learners</h1>
<p>Let’s pick just a few base learners to match the examples in my slides: a random forest, a generalized boosting model, and a generalized linear model. Let’s keep their default parameters for now.</p>
<p><code>make_learner_stack()</code> is an easy way to create a stack of default baselearners. It takes the names of the learners as strings and you’re good to go!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>stack <span class="ot">&lt;-</span> <span class="fu">make_learner_stack</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Lrnr_randomForest"</span>, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Lrnr_gbm"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Lrnr_glm"</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-4-choose-a-metalearner" class="level1">
<h1>Step 4: Choose a metalearner</h1>
<p>There are many models we can choose from but we’ll keep it simple and use a generalized linear model. We are again using the <code>make_learner()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>metalearner <span class="ot">&lt;-</span> <span class="fu">make_learner</span>(Lrnr_glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-5-make-a-superlearner-object" class="level1">
<h1>Step 5: Make a superlearner object</h1>
<p>Remember, under-the-hood <code>Lrnr_sl</code> takes the cross-validated predictions from the base models and uses them to predict the true outcome. That prediction model then is used to fit the predictions from base learners fit on the whole data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>sl <span class="ot">&lt;-</span> <span class="fu">make_learner</span>(Lrnr_sl, </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">learners =</span> stack,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">metalearner =</span> metalearner)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A superlearner object has different functions built into it, such as <code>train()</code>. We can train our superlearner shell model on the task we made earlier.</p>
</section>
<section id="step-6-train-your-superlearner" class="level1">
<h1>Step 6: Train your superlearner</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>sl_fit <span class="ot">&lt;-</span> sl<span class="sc">$</span><span class="fu">train</span>(washb_task)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-7-examine-the-results-of-the-superlearner" class="level1">
<h1>Step 7: Examine the results of the superlearner</h1>
<section id="examine-coefficients-and-cv-risk" class="level2">
<h2 class="anchored" data-anchor-id="examine-coefficients-and-cv-risk">Examine coefficients and CV-risk</h2>
<p>The default risk is MSE (Mean Squared Error). The coefficients show you how the metalearner decided to weight each base model for the final ensemble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>sl_fit<span class="sc">$</span><span class="fu">print</span>() <span class="sc">%&gt;%</span> <span class="fu">gt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SuperLearner:"
List of 3
 $ : chr "Lrnr_randomForest_500_TRUE_5"
 $ : chr "Lrnr_gbm_10000_2_0.001"
 $ : chr "Lrnr_glm_TRUE"
[1] "Lrnr_glm_TRUE"
$coefficients
                   intercept Lrnr_randomForest_500_TRUE_5 
                -0.037630882                  0.056299184 
      Lrnr_gbm_10000_2_0.001                Lrnr_glm_TRUE 
                 0.876353346                  0.005369642 

$R
                             intercept Lrnr_randomForest_500_TRUE_5
intercept                    -68.52007                     39.84692
Lrnr_randomForest_500_TRUE_5   0.00000                     21.59036
Lrnr_gbm_10000_2_0.001         0.00000                      0.00000
Lrnr_glm_TRUE                  0.00000                      0.00000
                             Lrnr_gbm_10000_2_0.001 Lrnr_glm_TRUE
intercept                                  40.07621     40.091631
Lrnr_randomForest_500_TRUE_5               14.60067     13.860606
Lrnr_gbm_10000_2_0.001                     10.05776      9.862373
Lrnr_glm_TRUE                               0.00000     -8.642721

$rank
[1] 4

$family

Family: gaussian 
Link function: identity 


$deviance
[1] 4723.324

$aic
[1] 13362.07

$null.deviance
[1] 5000.347

$iter
[1] 2

$df.residual
[1] 4691

$df.null
[1] 4694

$converged
[1] TRUE

$boundary
[1] FALSE

$linkinv_fun
function (eta) 
eta
&lt;environment: namespace:stats&gt;

$link_fun
function (mu) 
mu
&lt;environment: namespace:stats&gt;

$training_offset
[1] FALSE

[1] "Cross-validated risk:"
                        learner coefficients      MSE        se    fold_sd
1: Lrnr_randomForest_500_TRUE_5  0.056299184 1.034798 0.0237462 0.07053924
2:       Lrnr_gbm_10000_2_0.001  0.876353346 1.006393 0.0233679 0.07188694
3:                Lrnr_glm_TRUE  0.005369642 1.021995 0.0238539 0.06474016
4:                 SuperLearner           NA 1.006033 0.0233913 0.07107934
   fold_min_MSE fold_max_MSE
1:    0.9099614     1.165088
2:    0.8753148     1.121065
3:    0.8900577     1.116998
4:    0.8772851     1.119882</code></pre>
</div>
<div class="cell-output-display">

<div id="cptwmtqzfn" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#cptwmtqzfn .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#cptwmtqzfn .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cptwmtqzfn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#cptwmtqzfn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#cptwmtqzfn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cptwmtqzfn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cptwmtqzfn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#cptwmtqzfn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#cptwmtqzfn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#cptwmtqzfn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#cptwmtqzfn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#cptwmtqzfn .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#cptwmtqzfn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#cptwmtqzfn .gt_from_md > :first-child {
  margin-top: 0;
}

#cptwmtqzfn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#cptwmtqzfn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#cptwmtqzfn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#cptwmtqzfn .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#cptwmtqzfn .gt_row_group_first td {
  border-top-width: 2px;
}

#cptwmtqzfn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cptwmtqzfn .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#cptwmtqzfn .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#cptwmtqzfn .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cptwmtqzfn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cptwmtqzfn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#cptwmtqzfn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#cptwmtqzfn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cptwmtqzfn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cptwmtqzfn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cptwmtqzfn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cptwmtqzfn .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cptwmtqzfn .gt_left {
  text-align: left;
}

#cptwmtqzfn .gt_center {
  text-align: center;
}

#cptwmtqzfn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#cptwmtqzfn .gt_font_normal {
  font-weight: normal;
}

#cptwmtqzfn .gt_font_bold {
  font-weight: bold;
}

#cptwmtqzfn .gt_font_italic {
  font-style: italic;
}

#cptwmtqzfn .gt_super {
  font-size: 65%;
}

#cptwmtqzfn .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#cptwmtqzfn .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#cptwmtqzfn .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#cptwmtqzfn .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#cptwmtqzfn .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#cptwmtqzfn .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true">
<thead class="gt_col_headings">
<tr class="header">
<th class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th">learner</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">coefficients</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">MSE</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">se</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">fold_sd</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">fold_min_MSE</th>
<th class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th">fold_max_MSE</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center">Lrnr_randomForest_500_TRUE_5</td>
<td class="gt_row gt_right">0.056299184</td>
<td class="gt_row gt_right">1.034798</td>
<td class="gt_row gt_right">0.0237462</td>
<td class="gt_row gt_right">0.07053924</td>
<td class="gt_row gt_right">0.9099614</td>
<td class="gt_row gt_right">1.165088</td>
</tr>
<tr class="even">
<td class="gt_row gt_center">Lrnr_gbm_10000_2_0.001</td>
<td class="gt_row gt_right">0.876353346</td>
<td class="gt_row gt_right">1.006393</td>
<td class="gt_row gt_right">0.0233679</td>
<td class="gt_row gt_right">0.07188694</td>
<td class="gt_row gt_right">0.8753148</td>
<td class="gt_row gt_right">1.121065</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center">Lrnr_glm_TRUE</td>
<td class="gt_row gt_right">0.005369642</td>
<td class="gt_row gt_right">1.021995</td>
<td class="gt_row gt_right">0.0238539</td>
<td class="gt_row gt_right">0.06474016</td>
<td class="gt_row gt_right">0.8900577</td>
<td class="gt_row gt_right">1.116998</td>
</tr>
<tr class="even">
<td class="gt_row gt_center">SuperLearner</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">1.006033</td>
<td class="gt_row gt_right">0.0233913</td>
<td class="gt_row gt_right">0.07107934</td>
<td class="gt_row gt_right">0.8772851</td>
<td class="gt_row gt_right">1.119882</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="look-at-the-predictions" class="level2">
<h2 class="anchored" data-anchor-id="look-at-the-predictions">Look at the predictions</h2>
<p><code>predict()</code> allows you to see what the model predicts on any given task. Here we look at predictions from the same data we trained the superlearner on, so the predicted weight to height z-scores of the first six children in our data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>sl_fit<span class="sc">$</span><span class="fu">predict</span>(washb_task) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.6641946 -0.7508882 -0.7014290 -0.7542267 -0.6456398 -0.6791542</code></pre>
</div>
</div>
</section>
</section>
<section id="extras" class="level1">
<h1>Extras</h1>
<ul>
<li><p>Cross validate your entire ensembled superlearner using the cross-validation package <code>origami</code>, written by the same authors as <code>sl3</code>. Or just hold out a testing data set to evaluate performance.</p></li>
<li><p>Use <code>make_learner()</code> to customize the tuning parameters of your base learners or metalearner. Ex: <code>lrnr_RF_200trees &lt;- make_lrnr(Lrnr_randomForest, ntree = 200)</code></p></li>
<li><p>Add many layers to your superlearner and organize it into a “pipeline”</p></li>
</ul>
<p><strong>For more demos, check out the following teaching materials from the authors of <code>sl3</code>.</strong> My tutorial uses one of their example data sets in case you’d like to extend your learning via their training resources.</p>
<ul>
<li><p>https://tlverse.org/tlverse-handbook/ensemble-machine-learning.html</p></li>
<li><p>https://tlverse.org/acic2019-workshop/ensemble-machine-learning.html</p></li>
<li><p>https://github.com/tlverse/sl3_lecture</p></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp("www\.khstats\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>